<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../iron-icons/notification-icons.html">
<link rel="import" href="../iron-label/iron-label.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<!--
An element representing the restart signal for a device

Example:

    <seed-element></seed-element>

@demo
-->
<dom-module id="seed-element">

  <style>
    paper-fab {
      background: orange; // init & rebooting state
    }
  </style>

  <template>
   
    <iron-label id="device-name" onmouseover="showEdit('name')" onmouseout="removeEdit('name')">
      {{device_name}}
    <paper-fab class="restart" id="device-power" onclick="rotateOut()" icon="notification:power"></paper-fab>
    </iron-label>
   <!-- <input value={{device_name}}> -->
  </template>

</dom-module>
<script>

  Polymer({

    is: 'seed-element',
    
    properties: {
      device_id: Number,
      device_name: {
        type: String,
        notify: true,
        value: 'device name'
      },
      location: {
        type: String,
        notify: true
      },
      protocol: {
        type: String,
        notify: true
      },
      address: {
        type: String,
        notify: true
      }
    },

      
   _nameChanged: function () {
     // get contents of edit field
     var name_edit = this.querySelector('#device-name-edit');
     var name_new = name_edit.value;
     // assign value of label new name
     var device_name_elem = this.querySelector('#device-name');
     device_name_elem.value = name_new;
   },
   _editClicked: function(elem) {
     switch(elem) {
       case "name":
         _nameChanged();
         break;
     }
   },

   _locationChanged: function (newValue, oldValue) {
   
   },
   _protoChanged: function (newValue, oldValue) {
   
   },
  _addressChanged: function (newValue, oldValue) {
   
   }

    
  });
  
  function rotateOut() {
    var elem = document.querySelector('.restart');
    var transformOrigin = elem.style['transform-origin'];
    var keyframes = [
      {transform: 'none', opacity: '1', transformOrigin: 'center', offset: 0}, 
      {transform: 'rotate3d(0, 0, 1, 200deg)', opacity: '0', transformOrigin: 'center', offset: 1}
    ];
    var timing = {duration: 900, iterations: 3};// change 3 to Infinity when we have a signal
    // random number gen since we don't have a real signal yet.
    var state = Math.floor(((Math.random()*10)+1) % 2);
    
    elem.animate(keyframes, timing);
    var rotate = elem.animate(keyframes, timing); 
    //send restart signal here & call rotate.finish() when signal recieved or timed out

    
    rotate.onfinish = function() {
    // conditional for state styling based on even (green) & odd (red)
      state == 0 ? elem.style.background = "green" : elem.style.background = "red";
    }
  }
  
  function showEdit(elem){
     switch(elem) {
      case "name":
        //var label = document.querySelector('#'+elem+'');
        var toInsert = document.createElement("<iron-icon icon=icons:'create'></iron-icon>");
        var beforeNode = Polymer.dom(this.root).childNodes[0];
        Polymer.dom(this.root).insertBefore(toLocal, beforeNode);
     }
   }
   
  function removeEdit(elem){
    alert(elem);
  }
</script>
